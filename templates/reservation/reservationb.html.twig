{% extends 'main/base-back.html.twig' %}
{% block title %}mes reservation{% endblock %}

{% block nav %}<!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">

      <div class="layout-container">
        <!-- Menu -->

        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <div class="app-brand demo">
            <a href="{{ path('app_dashboard') }}" class="app-brand-link">
              <img src="{{asset('back-office/assets/img/logo.png')}}" width="50">
              <span class="app-brand-text demo menu-text fw-bolder ms-2">EcoBikeGo</span>
            </a>

            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
              <i class="bx bx-chevron-left bx-sm align-middle"></i>
            </a>
          </div>

          <div class="menu-inner-shadow"></div>

          <ul class="menu-inner py-1">
            <!-- Dashboard -->
            <li class="menu-item">
              <a href="{{ path('app_dashboard') }}" class="menu-link">
                <i class="menu-icon tf-icons bx bx-home-circle"></i>
                <div data-i18n="Analytics">Dashboard</div>
              </a>
            </li>



            <li class="menu-header small text-uppercase">
              <span class="menu-header-text">Pages</span>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-dock-top"></i>
                <div >Gestion User</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="{{ path('app_profileb') }}" class="menu-link">
                    <div data-i18n="Account">Accounts</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="pages-account-settings-notifications.html" class="menu-link">
                    <div data-i18n="Notifications">Notifications</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="pages-account-settings-connections.html" class="menu-link">
                    <div data-i18n="Connections">Connections</div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="menu-item active open">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-dock-top"></i>
                <div data-i18n="Authentications">Gestion Stations</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item active">
                  <a href="{{ path('app_reservationb') }}" class="menu-link" >
                    <div data-i18n="Basic">Mes reservations</div>
                  </a>
                </li>
                <li class="menu-item ">
                  <a href="{{ path('app_stationb') }}" class="menu-link" >
                    <div data-i18n="Basic">Mes Stations</div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-dock-top"></i>
                <div data-i18n="Misc">Gestion Vélos</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="{{ path('app_velob') }}" class="menu-link">
                    <div data-i18n="Error">liste de velos</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="pages-misc-under-maintenance.html" class="menu-link">
                    <div data-i18n="Under Maintenance">Under Maintenance</div>
                  </a>
                </li>
              </ul>
            </li>

            <!-- Extended components -->
            <li class="menu-item">
              <a href="javascript:void(0)" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-copy"></i>
                <div data-i18n="Extended UI">Gestion Evénements</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="{{ path('app_evenementb') }}" class="menu-link">
                    <div data-i18n="Perfect Scrollbar">nos evenements</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="extended-ui-text-divider.html" class="menu-link">
                    <div data-i18n="Text Divider">Text Divider</div>
                  </a>
                </li>
              </ul>
            </li>

            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-detail"></i>
                <div data-i18n="Form Elements">Gestion Réclamations</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="{{ path('app_reclamationb') }}" class="menu-link">
                    <div data-i18n="Basic Inputs">liste des reclamations</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="forms-input-groups.html" class="menu-link">
                    <div data-i18n="Input groups">Input groups</div>
                  </a>
                </li>
              </ul>
            </li>
          <div class="border py-4 px-4 mb-2 rounded-md shadow-sm border-gray-100"><div class="flex items-center justify-between">
        <h5>Filtre Avancé</h5><br>

          </div>
          <button class="btn btn-outline-danger" style="font-size:13px;">Réinitialiser le filtre</button>
          
          <input list="ice-cream-flavors" id="filter-name" name="ice-cream-choice">
<label for="ice-cream-choice">Choose a flavor:</label>




<datalist id="ice-cream-flavors">
    <option value="femme">
    <option value="tout terrin">
    <option value="racing">
    <option value="enfant">
</datalist>
          </div>
          </ul>



        </aside>

        <!-- / Menu -->{% endblock %}
{% block body %}
<div class="container" >
<div class="row">
<h1>mes reservation</h1>
</div>

<div class="row">
<div class="col-1" style="writing-mode: vertical-lr;
			text-orientation: mixed;
			white-space: nowrap;" align="center">
vélos réservés par ville
</div>
<div class="col-3">

<div>
  <canvas id="myChart2"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const chartData = {};

  {% for k in liss %}
    if (!chartData["{{ k.getIdStation().localisationStation }}"]) {
      chartData["{{ k.getIdStation().localisationStation }}"] = {{ k.getNbr() }};
    } else {
      chartData["{{ k.getIdStation().localisationStation }}"] += {{ k.getNbr() }};
    }
  {% endfor %}

  const ctx = document.getElementById('myChart2');

  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: Object.keys(chartData),
      datasets: [{
        label: 'Vélos',
        data: Object.values(chartData),
        backgroundColor: [
          '#FF6384',
          '#36A2EB',
          '#FFCE56',
          '#8BC34A',
          '#9C27B0',
          '#FF9800',
          '#607D8B',
          '#795548',
          '#E91E63',
          '#00BCD4',
        ]
      }]
    }
  });
</script></div>
<div class="col-1" style="writing-mode: vertical-lr;
			text-orientation: mixed;
			white-space: nowrap;" align="center">
vélos réservés par type
</div><div class="col-3">


<div>
  <canvas id="myChart3"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const chartData1 = {};

  {% for k in liss %}
    if (!chartData1["{{ k.getIdVelo().titre }}"]) {
      chartData1["{{ k.getIdVelo().titre }}"] = {{ k.getNbr() }};
    } else {
      chartData1["{{ k.getIdVelo().titre }}"] += {{ k.getNbr() }};
    }
  {% endfor %}

  const ctx3 = document.getElementById('myChart3');

  new Chart(ctx3, {
    type: 'polarArea',
    data: {
      labels: Object.keys(chartData1),
      datasets: [{
        
        label: 'vélos',
        data: Object.values(chartData1)
      }]
    },
    options: {
    responsive: true,
    scales: {
      r: {
        pointLabels: {
          display: true,
          centerPointLabels: true,
          font: {
            size: 13
          }
        }
      }
    },
     plugins: {
      legend: {
        position: 'top',
      }
    }
  },
  });
</script>

</div><div class="col-1" style="writing-mode: vertical-lr;
			text-orientation: mixed;
			white-space: nowrap;" align="center">
revenue  par mois
</div>
<div class="col-3">

<canvas id="myChart4"></canvas>

<script>
const labels = [];
const data = {};

{% for k in liss %}
    if (!data["{{ k.getDateDebut()|date("M") }}"]) {
      data["{{ k.getDateDebut()|date("M") }}"] = {{ k.getNbr() * k.getPrixr() }};
    } else {
      data["{{ k.getDateDebut()|date("M") }}"] += {{ k.getNbr() * k.getPrixr() }};
    }
  {% endfor %}


const ctx4 = document.getElementById('myChart4').getContext('2d');
const config4 = {
  type: 'line',
  data: {
    labels: labels,
    datasets: [{
      label: 'chiffre d\'affaire',
      data: data,
      backgroundColor: 'rgba(255, 99, 132, 0.5)',
      borderColor: 'rgba(255, 99, 132, 1)',
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: {
        ticks: {
          beginAtZero: true
        }
      }
    },
    plugins: {
      title: {
        display: true,
        text: 'chiffre d\'affaire par rapport au mois'
      }
    }
  }
};

new Chart(ctx4, config4);


</script>
</div>


</div><br>
<div class="row">
    <table class="table table-striped  table-bordered" style="background-color: #e3eeed;" id="customers-table">
        <thead  style="background-color: #8e90ff;">
        <tr>
                <th colspan="5">reservation:</th>
                <th colspan="2">station:</th>
                
                <th colspan="2">client:</th>

                <th colspan="2">velo:</th>
            </tr>
            <tr>
                <th>Date de début</th>
                <th>Date de fin</th>
                <th>Prixr</th>
                <th>Nbr</th>
                <th>Total</th>

                <th>nom station</th>
                <th>Ville</th>
                
                <th>nom/prenom</th>
                <th>email</th>

                <th>nom</th>
                <th>catégorie</th>
            </tr>
        </thead>
        <tbody><script>var x=0;</script>
            {% for k in liss %}
            <tr data-name="{{ k.getIdVelo().titre }}">
                <td>{{ k.getDateDebut()|date('d-m-Y / H:i:s') }}</td>
                <td>{{ k.getDateFin()|date('d-m-Y / H:i:s') }}</td>
                <td>{{ k.getPrixr() }}</td>
                <td>{{ k.getNbr() }}</td>
                <td>{{ k.getNbr() * k.getPrixr() }}</td>
                <td>{{ k.getIdStation().nomStation }}</td>
                <td>{{ k.getIdStation().localisationStation }}</td>
                <td>{{ k.getIdUser().nomuser}}/{{ k.getIdUser().prenomuser }}</td>
                <td>{{ k.getIdUser().email }}</td>
                <td>{{ k.getIdVelo().titre }}</td>
                <td>{{ k.getIdVelo().getCategorie().getNomCategorie() }}</td>
            </tr>
            <script>x+={{ k.getNbr() * k.getPrixr() }};</script>
            {% endfor %}
            
            <tr><td colspan="3"></td><td colspan="2" style="background-color: #e3eeed; color:black;"><b><div id="a">Initial text</div></b></td><td></td></tr>
        </tbody>
    </table>
    </div>
    <script>document.getElementById("a").innerHTML = "Total: " + x + " TND";</script>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
       const filterInput = document.querySelector('#filter-name');
const tableRows = document.querySelectorAll('#customers-table tbody tr');

filterInput.addEventListener('keyup', () => {
  const filterValue = filterInput.value.toLowerCase();
  tableRows.forEach(row => {
    const name = row.getAttribute('data-name').toLowerCase();
    if (name.indexOf(filterValue) > -1) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
});

    </script>
{% endblock %}
